<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pose Estimation 라벨링 툴 (Material Design 3)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/split.js/dist/split.min.js"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="icon.svg" type="image/svg+xml">
</head>
<body>

    <!-- 상단 툴박스 -->
    <header class="p-2 shadow-md flex-shrink-0 flex items-center gap-2" style="background-color: var(--md-sys-color-surface-container); border-bottom: 1px solid var(--md-sys-color-outline-variant);">
        <img src="icon.svg" id="app-icon" class="w-8 h-8 mx-2 cursor-pointer">
        <div class="h-8 w-px" style="background-color: var(--md-sys-color-outline-variant);"></div>
        <input type="file" id="configLoader" accept=".json" class="hidden">
        <button id="btnLoadConfig" class="btn btn-tonal">Config 열기</button>
        
        <input type="file" id="imageDirLoader" webkitdirectory multiple class="hidden">
        <button id="btnLoadImageDir" class="btn btn-tonal" disabled>이미지 폴더 열기</button>

        <input type="file" id="labelDirLoader" webkitdirectory multiple class="hidden">
        <input type="file" id="sapiensDirLoader" webkitdirectory multiple class="hidden">
        <button id="btnOpenLabelModal" class="btn btn-tonal" disabled>라벨 폴더 열기</button>

        <button id="btnSave" class="btn btn-filled" disabled>전체 JSON 저장 (ZIP)</button>
        
        <div class="flex-grow"></div>

        <div class="flex items-center gap-2 mr-2">
            <button id="btnPrev" class="btn btn-icon btn-tonal" disabled title="이전 이미지 (←)"></button>
            <p id="imageProgress" class="text-sm w-20 text-center" style="color: var(--md-sys-color-on-surface-variant);">0 / 0</p>
            <button id="btnNext" class="btn btn-icon btn-tonal" disabled title="다음 이미지 (→)"></button>
            <div class="h-8 w-px mx-2" style="background-color: var(--md-sys-color-outline-variant);"></div>
            <button id="btnShortcutSettings" class="btn btn-icon btn-tonal" title="단축키 설정"></button>
        </div>
    </header>

    <div id="app-body" class="flex flex-row flex-grow overflow-hidden">
        <!-- Left Sidebar Container -->
        <div id="left-sidebar-container">
            <!-- Sidebar Toggles -->
            <div id="left-sidebar-toggles">
                <button id="label-sidebar-toggle" class="btn btn-icon" title="Label Viewer">
                    <!-- Icon will be inserted by JS -->
                </button>
                <button id="image-list-sidebar-toggle" class="btn btn-icon" title="Image List">
                    <!-- Icon will be inserted by JS -->
                </button>
            </div>

            <!-- Label Viewer Panel -->
            <aside id="label-sidebar" class="shadow-lg">
                <div class="p-4" style="background-color: var(--md-sys-color-surface-container-high);">
                    <h2 class="text-lg font-bold">Label Viewer</h2>
                </div>
                <div class="flex p-2 gap-2" style="background-color: var(--md-sys-color-surface-container);">
                    <button id="btn-live-json" class="btn btn-tonal flex-grow text-sm">JSON</button>
                    <button id="btn-yolo-pose" class="btn btn-tonal flex-grow text-sm">YOLO</button>
                    <button id="btn-mf-yolo-pose" class="btn btn-tonal flex-grow text-sm">MF_YOLO</button>
                </div>
                <div id="label-content-wrapper" class="flex-grow p-2 overflow-y-auto">
                    <div id="live-json-content" class="relative h-full">
                        <div class="absolute top-0 right-0 flex gap-1 z-10">
                            <button id="btn-copy-live" class="btn btn-icon btn-tonal"></button>
                            <button id="btn-download-live" class="btn btn-icon btn-tonal"></button>
                        </div>
                        <pre><code id="live-json-output" class="text-xs">{}</code></pre>
                    </div>
                    <div id="yolo-pose-content" class="hidden relative h-full">
                        <div class="absolute top-0 right-0 flex gap-1 z-10">
                            <button id="btn-copy-yolo" class="btn btn-icon btn-tonal"></button>
                            <button id="btn-download-yolo" class="btn btn-icon btn-tonal"></button>
                        </div>
                        <pre><code id="yolo-pose-output" class="text-xs"></code></pre>
                    </div>
                    <div id="mf-yolo-pose-content" class="hidden relative h-full">
                        <div class="absolute top-0 right-0 flex gap-1 z-10">
                            <button id="btn-copy-mf-yolo" class="btn btn-icon btn-tonal"></button>
                            <button id="btn-download-mf-yolo" class="btn btn-icon btn-tonal"></button>
                        </div>
                        <pre><code id="mf-yolo-pose-output" class="text-xs"></code></pre>
                    </div>
                </div>
            </aside>

            <!-- Image List Panel -->
            <aside id="image-list-sidebar" class="shadow-lg">
                <div class="p-4 flex justify-between items-center" style="background-color: var(--md-sys-color-surface-container-high);">
                    <h2 class="text-lg font-bold">Image List</h2>
                </div>
                <div class="p-2 gap-2 flex items-center" style="background-color: var(--md-sys-color-surface-container);">
                    <button id="view-mode-icon" class="btn btn-icon btn-tonal active"></button>
                    <button id="view-mode-list" class="btn btn-icon btn-tonal"></button>
                    <input type="range" id="thumbnail-size-slider" min="50" max="200" value="100" class="w-full h-2 rounded-lg appearance-none cursor-pointer">
                </div>
                <div id="image-list-content-wrapper" class="flex-grow p-2 overflow-y-auto">
                    <!-- Image items will be populated here -->
                </div>
            </aside>

            <!-- Resizer -->
            <div id="left-sidebar-resizer"></div>
        </div>


        <!-- 메인 컨텐츠 영역 -->
        <div id="split-container" class="flex-grow flex p-4 overflow-hidden">
            <!-- 중앙 캔버스 -->
            <main id="split-0" class="rounded-2xl shadow-lg flex items-center justify-center overflow-hidden relative" style="background-color: #000;">
                <canvas id="mainCanvas" class="rounded-md shadow-inner"></canvas>
                <div id="mode-indicator" class="absolute top-2 left-1/2 -translate-x-1/2 text-white text-xs font-bold px-2 py-1 rounded hidden"></div>
                <div id="canvas-loader" class="absolute inset-0 bg-black bg-opacity-50 flex-col items-center justify-center text-white text-lg hidden"></div>
            </main>

            <!-- 오른쪽 패널 -->
            <aside id="split-1" class="rounded-2xl shadow-lg flex flex-col" style="background-color: var(--md-sys-color-surface-container);">
                <div class="p-4 border-b flex items-center gap-4" style="border-color: var(--md-sys-color-outline-variant);">
                    <div id="class-selector-wrapper" class="hidden flex-grow">
                        <div class="flex items-center gap-2">
                            <span id="class-color-indicator" class="w-5 h-5 rounded-full block flex-shrink-0"></span>
                            <select id="class-selector" class="w-full rounded-md p-2 flex-grow" style="background-color: var(--md-sys-color-surface-container-highest);"></select>
                        </div>
                    </div>
                    <button id="btnAddObject" class="btn btn-filled" disabled>+ 객체 추가</button>
                </div>
                <div class="flex-grow details-scroll-container">
                    <div id="config-help" class="p-4 text-sm" style="color: var(--md-sys-color-on-surface-variant);"></div>
                    <div id="gamma-control-wrapper" class="p-2 border-b" style="border-color: var(--md-sys-color-outline-variant);"></div>
                    <div id="object-list-wrapper" class="p-2 space-y-2"></div>
                    <div id="details-wrapper" class="p-2 border-t hidden" style="border-color: var(--md-sys-color-outline-variant);"></div>
                </div>
            </aside>
        </div>
    </div>
    
    <footer class="p-2 shadow-inner flex-shrink-0 flex justify-between items-center text-sm" style="background-color: var(--md-sys-color-surface-container-high); border-top: 1px solid var(--md-sys-color-outline-variant);"></footer>

    <div id="toast-popup"></div>

    <!-- 단축키 설정 모달 -->
    <div id="shortcutModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div class="p-6 rounded-2xl shadow-xl w-full max-w-lg" style="background-color: var(--md-sys-color-surface-container-high);">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">단축키 설정</h3>
                <button id="btnModalClose" class="btn btn-icon">&times;</button>
            </div>
            <div id="shortcutList" class="space-y-2 max-h-96 overflow-y-auto">
                <!-- 단축키 목록이 여기에 동적으로 채워집니다. -->
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button id="btnResetShortcuts" class="btn btn-tonal">기본값으로 초기화</button>
                <button id="btnSaveShortcuts" class="btn btn-filled">저장</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="module" src="src/main.js"></script>

    <!-- Icon Modal -->
    <div id="icon-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center" style="background-color: rgba(0, 0, 0, 0.6);">
        <div class="relative">
            <img src="icon.svg" id="icon-modal-content" style="width: 358px; height: 358px;">
            <p class="absolute -bottom-6 left-0 text-white font-semibold pointer-events-none" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.7);">MF labeling tool</p>
        </div>
    </div>
</body>
</html>
