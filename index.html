<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pose Estimation 라벨링 툴 (Material Design 3)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/split.js/dist/split.min.js"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- 상단 툴박스 -->
    <header class="p-2 shadow-md flex-shrink-0 flex items-center gap-2" style="background-color: var(--md-sys-color-surface-container); border-bottom: 1px solid var(--md-sys-color-outline-variant);">
        <svg class="w-8 h-8 text-blue-400 mx-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 8.25C4 7.55964 4.55964 7 5.25 7H18.75C19.4404 7 20 7.55964 20 8.25V15.75C20 16.4404 19.4404 17 18.75 17H5.25C4.55964 17 4 16.4404 4 15.75V8.25Z" stroke="currentColor" stroke-width="1.5"></path><path d="M7.5 7V5.5C7.5 4.39543 8.39543 3.5 9.5 3.5H14.5C15.6046 3.5 16.5 4.39543 16.5 5.5V7" stroke="currentColor" stroke-width="1.5"></path><path d="M14.5 19.5V21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path><path d="M9.5 19.5V21" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path><path d="M12 12V14.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path><path d="M12 9.5V8.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path><path d="M9 12H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path><path d="M17 12H15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>
        <div class="h-8 w-px" style="background-color: var(--md-sys-color-outline-variant);"></div>
        <input type="file" id="configLoader" accept=".json" class="hidden">
        <button id="btnLoadConfig" class="btn btn-tonal">Config 열기</button>
        
        <input type="file" id="dirLoader" webkitdirectory multiple class="hidden">
        <button id="btnLoadDir" class="btn btn-tonal" disabled>이미지 폴더 열기</button>

        <button id="btnSave" class="btn btn-filled" disabled>전체 JSON 저장 (ZIP)</button>
        
        <div class="flex-grow"></div>

        <div class="flex items-center gap-2 mr-2">
            <button id="btnPrev" class="btn btn-icon btn-tonal" disabled title="이전 이미지 (←)"></button>
            <p id="imageProgress" class="text-sm w-20 text-center" style="color: var(--md-sys-color-on-surface-variant);">0 / 0</p>
            <button id="btnNext" class="btn btn-icon btn-tonal" disabled title="다음 이미지 (→)"></button>
            <div class="h-8 w-px mx-2" style="background-color: var(--md-sys-color-outline-variant);"></div>
            <button id="btnShortcutSettings" class="btn btn-icon btn-tonal" title="단축키 설정"></button>
        </div>
    </header>

    <!-- JSON Viewer Sidebar -->
    <div id="json-sidebar-container">
        <button id="json-sidebar-toggle" class="btn btn-icon" title="JSON Viewer">
            <!-- Icon will be inserted by JS -->
        </button>
        <aside id="json-sidebar" class="shadow-lg">
            <div class="p-4" style="background-color: var(--md-sys-color-surface-container-high);">
                <h2 class="text-lg font-bold">JSON Viewer</h2>
            </div>
            <div class="flex p-2 gap-2" style="background-color: var(--md-sys-color-surface-container);">
                <button id="btn-live-json" class="btn btn-tonal flex-grow text-sm">실시간 JSON</button>
                <button id="btn-coco-json" class="btn btn-tonal flex-grow text-sm">COCO 포맷</button>
            </div>
            <div id="json-content-wrapper" class="flex-grow p-2 overflow-y-auto">
                <!-- Live JSON Content -->
                <div id="live-json-content">
                    <div class="flex justify-end gap-2 mb-2">
                        <button id="btn-copy-live" class="btn btn-tonal text-xs">복사</button>
                        <button id="btn-download-live" class="btn btn-tonal text-xs">다운로드</button>
                    </div>
                    <pre><code id="live-json-output" class="text-xs">{}</code></pre>
                </div>
                <!-- COCO JSON Content -->
                <div id="coco-json-content" class="hidden">
                    <div class="flex justify-end gap-2 mb-2">
                        <button id="btn-copy-coco" class="btn btn-tonal text-xs">복사</button>
                        <button id="btn-download-coco" class="btn btn-tonal text-xs">다운로드</button>
                    </div>
                    <pre><code id="coco-json-output" class="text-xs">{}</code></pre>
                </div>
            </div>
        </aside>
    </div>


    <!-- 메인 컨텐츠 영역 -->
    <div id="split-container" class="flex-grow flex p-4 gap-4 overflow-hidden">
        <!-- 중앙 캔버스 -->
        <main id="split-0" class="rounded-2xl shadow-lg flex items-center justify-center overflow-hidden relative" style="background-color: #000;">
            <canvas id="mainCanvas" class="rounded-md shadow-inner"></canvas>
            <div id="mode-indicator" class="absolute top-2 left-2 text-white text-xs font-bold px-2 py-1 rounded hidden"></div>
            <div id="canvas-loader" class="absolute inset-0 bg-black bg-opacity-50 flex-col items-center justify-center text-white text-lg hidden"></div>
        </main>

        <!-- 오른쪽 패널 -->
        <aside id="split-1" class="rounded-2xl shadow-lg flex flex-col" style="background-color: var(--md-sys-color-surface-container);">
            <div class="p-4 border-b space-y-4" style="border-color: var(--md-sys-color-outline-variant);">
                <div id="class-selector-wrapper" class="hidden">
                    <label for="class-selector" class="block text-sm font-medium mb-1">새 객체 클래스</label>
                    <div class="flex items-center gap-2">
                        <select id="class-selector" class="w-full rounded-md p-2 flex-grow" style="background-color: var(--md-sys-color-surface-container-highest);"></select>
                        <span id="class-color-indicator" class="w-5 h-5 rounded-full block flex-shrink-0"></span>
                    </div>
                </div>
                <button id="btnAddObject" class="btn btn-filled w-full" disabled>+ 객체 추가 (A)</button>
            </div>
            <div class="flex-grow details-scroll-container">
                <div id="config-help" class="p-4 text-sm" style="color: var(--md-sys-color-on-surface-variant);"></div>
                <div id="object-list-wrapper" class="p-2 space-y-2"></div>
                <div id="details-wrapper" class="p-2 border-t hidden" style="border-color: var(--md-sys-color-outline-variant);"></div>
            </div>
        </aside>
    </div>
    
    <footer class="p-2 shadow-inner flex-shrink-0 flex justify-between items-center text-sm" style="background-color: var(--md-sys-color-surface-container-high); border-top: 1px solid var(--md-sys-color-outline-variant);"></footer>

    <div id="toast-popup"></div>

    <!-- 단축키 설정 모달 -->
    <div id="shortcutModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
        <div class="p-6 rounded-2xl shadow-xl w-full max-w-lg" style="background-color: var(--md-sys-color-surface-container-high);">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">단축키 설정</h3>
                <button id="btnModalClose" class="btn btn-icon">&times;</button>
            </div>
            <div id="shortcutList" class="space-y-2 max-h-96 overflow-y-auto">
                <!-- 단축키 목록이 여기에 동적으로 채워집니다. -->
            </div>
            <div class="flex justify-end gap-4 mt-6">
                <button id="btnResetShortcuts" class="btn btn-tonal">기본값으로 초기화</button>
                <button id="btnSaveShortcuts" class="btn btn-filled">저장</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="module" src="src/main.js"></script>
</body>
</html>
